<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> LÊN ĐƠN NHANH CHO ANH EM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .invoice-box { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <!-- CỘT NHẬP LIỆU -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-xl font-bold mb-6 text-blue-600 border-b pb-2">Thông tin đơn hàng</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Tên khách hàng</label>
                    <input type="text" id="custName" oninput="updatePreview()" placeholder="Ví dụ: Anh Tuấn" class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">Ghi chú khách hàng</label>
                    <textarea id="custNote" oninput="updatePreview()" placeholder="Địa chỉ, số điện thoại..." class="mt-1 block w-full p-2 border border-gray-300 rounded-md h-20"></textarea>
                </div>

                <div class="pt-4 border-t">
                    <label class="block text-sm font-medium text-gray-700">Tên sản phẩm</label>
                    <input type="text" id="prodName" oninput="updatePreview()" placeholder="Ví dụ: Giày Sneaker" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Số lượng</label>
                        <input type="number" id="prodQty" oninput="updatePreview()" value="1" min="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Giá bán (VNĐ)</label>
                        <input type="number" id="prodPrice" oninput="updatePreview()" placeholder="500000" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Ghi chú sản phẩm</label>
                    <input type="text" id="prodNote" oninput="updatePreview()" placeholder="Màu sắc, size..." class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>

                <button onclick="exportImage()" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    Xuất Ảnh Hóa Đơn
                </button>
            </div>
        </div>

        <!-- CỘT XEM TRƯỚC HÓA ĐƠN -->
        <div>
            <h2 class="text-xl font-bold mb-6 text-gray-600">Bản xem trước</h2>
            
            <div id="invoice-preview" class="invoice-box border-t-4 border-blue-500">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">ĐƠN HÀNG</h1>
                        <p class="text-gray-500 text-sm italic" id="currentDate"></p>
                    </div>
                    <div class="text-right">
                        <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">PAID</span>
                    </div>
                </div>

                <div class="mb-8">
                    <p class="text-xs uppercase tracking-wider text-gray-400 font-semibold mb-1">Khách hàng</p>
                    <p id="viewCustName" class="text-lg font-semibold text-gray-800">Chưa nhập tên</p>
                    <p id="viewCustNote" class="text-sm text-gray-600 whitespace-pre-line"></p>
                </div>

                <table class="w-full mb-8 text-left">
                    <thead>
                        <tr class="border-b-2 border-gray-100">
                            <th class="py-2 font-semibold text-gray-600">Sản phẩm</th>
                            <th class="py-2 font-semibold text-gray-600 text-center">SL</th>
                            <th class="py-2 font-semibold text-gray-600 text-right">Đơn giá</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-50">
                            <td class="py-4">
                                <p id="viewProdName" class="font-medium text-gray-800">Sản phẩm chưa đặt</p>
                                <p id="viewProdNote" class="text-xs text-gray-500"></p>
                            </td>
                            <td id="viewProdQty" class="py-4 text-center text-gray-700">1</td>
                            <td id="viewProdPrice" class="py-4 text-right text-gray-700">0đ</td>
                        </tr>
                    </tbody>
                </table>

                <div class="flex justify-end border-t-2 border-gray-100 pt-4">
                    <div class="w-full max-w-[200px]">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-500">Tổng cộng:</span>
                            <span id="viewTotal" class="font-bold text-xl text-blue-600">0đ</span>
                        </div>
                    </div>
                </div>

                <div class="mt-12 text-center border-t border-dashed pt-4">
                    <p class="text-gray-400 text-xs italic">Cảm ơn quý khách đã ủng hộ!</p>
                </div>
            </div>
            
            <p id="statusMsg" class="mt-4 text-sm text-center text-gray-500 hidden font-medium">Đang tạo ảnh...</p>
        </div>
    </div>

    <script>
        // Hiển thị ngày hiện tại
        const now = new Date();
        document.getElementById('currentDate').innerText = `Ngày ${now.getDate()} tháng ${now.getMonth() + 1}, ${now.getFullYear()}`;

        function formatMoney(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        function updatePreview() {
            // Lấy dữ liệu
            const name = document.getElementById('custName').value || "Chưa nhập tên";
            const note = document.getElementById('custNote').value || "";
            const prod = document.getElementById('prodName').value || "Sản phẩm chưa đặt";
            const pNote = document.getElementById('prodNote').value || "";
            const qty = parseInt(document.getElementById('prodQty').value) || 0;
            const price = parseFloat(document.getElementById('prodPrice').value) || 0;

            // Cập nhật giao diện
            document.getElementById('viewCustName').innerText = name;
            document.getElementById('viewCustNote').innerText = note;
            document.getElementById('viewProdName').innerText = prod;
            document.getElementById('viewProdNote').innerText = pNote;
            document.getElementById('viewProdQty').innerText = qty;
            document.getElementById('viewProdPrice').innerText = formatMoney(price);
            document.getElementById('viewTotal').innerText = formatMoney(qty * price);
        }

        function exportImage() {
            const status = document.getElementById('statusMsg');
            status.classList.remove('hidden');
            
            const element = document.getElementById('invoice-preview');
            
            html2canvas(element, {
                scale: 2, // Tăng chất lượng ảnh
                backgroundColor: "#f3f4f6",
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                const custName = document.getElementById('custName').value || 'khach_hang';
                link.download = `HoaDon_${custName.replace(/\s+/g, '_')}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                
                status.innerText = "Đã tải ảnh xuống!";
                setTimeout(() => status.classList.add('hidden'), 3000);
            }).catch(err => {
                console.error("Lỗi xuất ảnh:", err);
                status.innerText = "Có lỗi xảy ra khi tạo ảnh.";
            });
        }

        // Chạy lần đầu
        updatePreview();
    </script>
</body>
</html>
